$(document).ready(function(){var k=$("#inv_req_item_quantity_reserved");if(k.length){var m,a,e,u=$("#sub-defaultreq_item_inv"),y=$("#rdy-defaultreq_item_inv-0"),f,q=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none"),r=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0"),n=S3.supply.reqData||{},b=k.val();b=b?parseFloat(b):0;var d=n.bq||0;var v=n.rq;stockQuantity=n.sq;n='<span id="TotalQuantity"> / '+stockQuantity.toFixed(2)+" "+n.pn+" ("+i18n.in_inv+")</span>";k.after(n);
u.on("click.s3",".inline-edt",function(){a=(a=r.val())?parseFloat(a):0;d-=a});y.click(function(){a=(a=r.val())?parseFloat(a):0;d+=a;q.change()});k.change(function(){(b=k.val())?(b=parseFloat(b),$("#inv_req_item_quantity_reserved-error").remove()):b=0;b>v?(b=v,f="Quantity Reserved decreased to Quantity Requested",e=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+f+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
k.val(v).parent().append(e).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1})):b<d&&(b=d,f="Quantity Reserved increased to Quantity in Bins",e=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+f+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),k.val(d).parent().append(e).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();
return!1}));q.change()});q.change(function(){a=(a=q.val())?parseFloat(a):0;m=b-d;a>m&&(f="Bin Quantity reduced to Quantity Reserved",e=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+f+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),q.val(m).parent().append(e).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});r.change(function(){a=
(a=r.val())?parseFloat(a):0;m=b-d;a>m&&(f="Bin Quantity reduced to Quantity Reserved",e=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+f+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),r.val(m).parent().append(e).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});u.on("rowAdded",function(c,g){d+=parseFloat(g.quantity.value);
$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning").remove()});u.on("rowRemoved",function(c,g){d-=parseFloat(g.quantity.value)})}$(document).on("click",".quantity.ajax_more",function(c){c.preventDefault();c=$(this);if(c.hasClass("collapsed")){if(c.hasClass("fulfil")){var g="recv";var w="track_item"}else c.hasClass("transit")?(g="send",w="track_item"):c.hasClass("commit")&&(g="commit",w="commit_item");c.after('<div class="ajax_throbber quantity_req_ajax_throbber"/>').removeClass("collapsed").addClass("expanded");
var h,l,x,t=$(".action-btn",c.parent().parent().parent()).attr("href");t=/req_item\/(\d*).*/i.exec(t)[1];t=S3.Ap.concat("/inv/",g,"_item_json.json/",t);$.ajax({url:t,dataType:"json",context:c}).done(function(p){l='<table class="recv_table">';for(h=0;h<p.length;h++)l+="<tr><td>",0===h?l+=p[0].id:(x=S3.Ap.concat("/inv/",g,"/",p[h].id,"/"+w),l+="<a href='"+x+"'>"+p[h].name+" - "+p[h].date+"</a>"),l+="</td><td>"+p[h].quantity+"</td></tr>";l+="</table>";$(".quantity_req_ajax_throbber",this.parent()).remove();
this.parent().after(l)})}else c.removeClass("expanded").addClass("collapsed"),$(".recv_table",c.parent().parent()).remove()})});
