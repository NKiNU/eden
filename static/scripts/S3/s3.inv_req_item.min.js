$(document).ready(function(){var u=$("#inv_req_item_quantity_reserved");if(u.length){var c,d,a,l,z,A,L=$("#rdy-defaultreq_item_inv-0"),p,B=$("#sub-defaultreq_item_inv"),h,f,b,C=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_none"),G=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none"),n=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none"),H=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none-hierarchy"),D=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_0"),
I=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0"),m=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0"),J=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0-hierarchy"),v=S3.supply.reqData||{},k=v.b||0,q=v.i||{},E=v.r,e=u.val();e=e?parseFloat(e):0;v="<span> / "+v.q.toFixed(2)+" "+v.p+" ("+i18n.in_inv+")</span>";u.after(v);B.on("click.s3",".inline-edt",function(){a=(a=m.val())?parseFloat(a):0;k-=a});L.click(function(){a=(a=m.val())?parseFloat(a):
0;k+=a;n.change()});u.change(function(){(e=u.val())?(e=parseFloat(e),$("#inv_req_item_quantity_reserved-error").remove()):e=0;e>E?(e=E,b="Quantity Reserved decreased to Quantity Requested",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+b+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),u.val(E).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();
return!1})):e<k&&(e=k,b="Quantity Reserved increased to Quantity in Bins",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+b+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),u.val(k).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});n.change(function(){if(a=n.val())c=e-k,a=parseFloat(a),b=null,(h=C.val())?(f=G.val())?(d=q[h].b[f],
c>=d?a>d&&(b="Bin Quantity reduced to Quantity in Bin"):a>c&&(b="Bin Quantity reduced to Quantity Reserved")):(d=q[h].q,c>=d?a>d&&(b="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(b="Bin Quantity reduced to Quantity Reserved")):a>c&&(b="Bin Quantity reduced to Quantity Reserved"),b&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+b+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
n.val(c).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});C.change(function(){if(h=C.val()){z=q[h].b;l=[];for(f in z)l.push(f);A=l.length;1==A?(f=l[0],H.hierarchicalopts("set",[f]),$(".s3-hierarchy-button").attr("disabled","disabled"),(a=n.val())?n.change():(c=e-k,d=q[h].b[f],n.val(Math.min(c,d)))):($(".s3-hierarchy-button").removeAttr("disabled"),H.hierarchicalopts("show",l,!0),n.change())}});G.change(function(){n.change()});
m.change(function(){if(a=m.val())c=e-k,a=parseFloat(a),b=null,(h=D.val())?(f=I.val())?(d=q[h].b[f],c>=d?a>d&&(b="Bin Quantity reduced to Quantity in Bin"):a>c&&(b="Bin Quantity reduced to Quantity Reserved")):(d=q[h].q,c>=d?a>d&&(b="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(b="Bin Quantity reduced to Quantity Reserved")):(c=e-k,a>c&&(b="Bin Quantity reduced to Quantity Reserved")),b&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+
b+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),m.val(c).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});D.change(function(){if(h=D.val()){z=q[h].b;l=[];for(f in z)l.push(f);A=l.length;1==A?(f=l[0],J.hierarchicalopts("set",[f]),$(".s3-hierarchy-button").attr("disabled","disabled"),(a=m.val())?m.change():(c=e-k,d=q[h].b[f],m.val(Math.min(c,d)))):($(".s3-hierarchy-button").removeAttr("disabled"),
J.hierarchicalopts("show",l),m.change())}});I.change(function(){m.change()});B.on("rowAdded",function(g,r){k+=parseFloat(r.quantity.value);$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning").remove()});B.on("rowRemoved",function(g,r){k-=parseFloat(r.quantity.value)})}$(document).on("click",".quantity.ajax_more",function(g){g.preventDefault();g=$(this);if(g.hasClass("collapsed")){if(g.hasClass("fulfil")){var r="recv";var F="track_item"}else g.hasClass("transit")?(r="send",
F="track_item"):g.hasClass("commit")&&(r="commit",F="commit_item");g.after('<div class="ajax_throbber quantity_req_ajax_throbber"/>').removeClass("collapsed").addClass("expanded");var t,w,K,y=$(".action-btn",g.parent().parent().parent()).attr("href");y=/req_item\/(\d*).*/i.exec(y)[1];y=S3.Ap.concat("/inv/",r,"_item_json.json/",y);$.ajax({url:y,dataType:"json",context:g}).done(function(x){w='<table class="recv_table">';for(t=0;t<x.length;t++)w+="<tr><td>",0===t?w+=x[0].id:(K=S3.Ap.concat("/inv/",r,
"/",x[t].id,"/"+F),w+="<a href='"+K+"'>"+x[t].name+" - "+x[t].date+"</a>"),w+="</td><td>"+x[t].quantity+"</td></tr>";w+="</table>";$(".quantity_req_ajax_throbber",this.parent()).remove();this.parent().after(w)})}else g.removeClass("expanded").addClass("collapsed"),$(".recv_table",g.parent().parent()).remove()})});
