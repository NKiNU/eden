$(document).ready(function(){var I=$("#inv_track_item_send_inv_item_id");if(I.length){var E,P,a,l=S3.supply.binnedQuantity||0,A,U=$("#inv_track_item_sub_defaultsend_bin__row"),B,w,C,J,m,ia=$("#rdy-defaultbin-0"),n,ba=$("#quantity__error"),c,F=$("#sub-defaultsend_bin"),x,ja=S3.supply.inv_items,V,k,Q=$("#inv_track_item_item_pack_id"),R,ka=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none"),p=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none"),y=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none-hierarchy"),
ca=/(\d)(?=(\d{3})+(?!\d))/g,la=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0"),t=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0"),D,ma=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0-hierarchy"),da,d,b,K,L,S,ea,h=$("#inv_track_item_quantity"),W=$("#inv_track_item_req_item_id__row"),u,M,G=I.val(),v,fa=S3.supply.itemPackID,X=1,g;$('div[id^="sub_defaultsend_bin_defaultsend_bin_i_layout_id"].s3-hierarchy-widget');var T,Y;W.length&&W.hide();var aa=function(){Z?(T=function(f){f.quantity.value=
e;f.quantity.text=e.toString().replace(ca,"$1,")},F.inlinecomponent("updateRows",T),$("#edt-defaultsend_bin-0").hide(),$("#rmv-defaultsend_bin-0").hide()):(U.show(),B=J[C[0]],B*k>e*b?p.val(e):p.val(B*k/b))};I.on("change.s3",function(f,z){x=I.val();Q.html("");z||(Z=!1,h.val(""),e=0,F.inlinecomponent("removeRows"),l=0);$("#TotalQuantity").remove();if(x){f=ja[x];V=f.q;L=f.p;S=L.length;u=f.r;for(c=0;c<S;c++)if(d=L[c],1==d.q){ea=d.n;break}for(c=0;c<S;c++){d=L[c];if(void 0!=d.d){var ha=!0;k=d.q}else ha=
!1;fa&&G==x&&fa==d.i?(R=d.i,D=X=b=d.q,K=d.n,M=" selected"):ha?(R=d.i,D=b=d.q,K=d.n,M=" selected"):M="";da=1!==d.q?'<option value="'+d.i+'"'+M+">"+d.n+" ("+d.q+" x "+ea+")</option>":'<option value="'+d.i+'"'+M+">"+d.n+"</option>";Q.append(da)}z&&(l=l*k/b);J=f.b;C=[];for(layoutID in J)C.push(layoutID);m=C.length;if(0==m)U.hide();else if(1==m)if(Z)$("#add-row-defaultsend_bin").hide(),$("#read-row-defaultsend_bin-0 > .subform-action").hide();else{aa();var N=function(){y.hierarchicalopts("set",[C[0]]);
p.attr("disabled","disabled");$("#add-row-defaultsend_bin > .subform-action").hide();y.next(".s3_inline_add_resource_link").hide();$(".s3-hierarchy-button").attr("disabled","disabled")};if(y.is(":data('s3-hierarchicalopts')"))N();else y.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()})}else if(U.show(),N=function(){p.removeAttr("disabled");$("#add-row-defaultsend_bin > .subform-action").show();y.next(".s3_inline_add_resource_link").show();$(".s3-hierarchy-button").removeAttr("disabled");
y.hierarchicalopts("show",C,!0);ma.hierarchicalopts("show",C,!0)},y.is(":data('s3-hierarchicalopts')"))N();else y.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()});if(ba.length)for(f=ba.html().split(" "),c=0;c<f.length&&!(g=parseFloat(f[c]));c++);else g=V*k/b,v&&G==x&&(g+=v*X/b);f='<span id="TotalQuantity"> / '+g.toFixed(2)+" "+K+" ("+i18n.in_inv+")</span>";h.after(f);if(u){var q=u[0];Y=function(){if(1==u.length){if(!v||G!=x){var r=q.q/b;e=r<=g?r:g;h.val(e);1==m&&aa()}$("#inv_track_item_req_item_id").val(q.i)}else{W.show();
var O=$("#inv_track_item_req_item_id"),H=O.val();H&&=parseInt(H);O.html("");for(c=0;c<u.length;c++)q=u[c],O.append(new Option(q.r,q.i)),H?q.i!=H||v&&G==x||(r=q.q/b,r<=g?h.val(r):h.val(g)):z&&(r=q.q/b,r<=g?h.val(r):h.val(g)),z=!1;O.on("change",function(){H=parseInt(O.val());for(c=0;c<u.length;c++)if(q=u[c],q.i==H){r=q.q/b;r<=g?h.val(r):h.val(g);break}})}};Y()}}});Q.on("change.s3",function(){R=parseInt(Q.val());for(c=0;c<S;c++)if(d=L[c],d.i==R){b=d.q;K=d.n;g=V*k/b;v&&G==x&&(g+=v*X/b);$("#TotalQuantity").html(g.toFixed(2)+
" "+K+" ("+i18n.in_inv+")");e=h.val();e=e*D/b;h.val(e);a=p.val();a=a*D/b;p.val(a);a=t.val();a=a*D/b;t.val(a);T=function(f){a=f.quantity.value;a=a*D/b;f.quantity.value=a;f.quantity.text=a.toString().replace(ca,"$1,")};F.inlinecomponent("updateRows",T);D=b;u&&Y();break}});if(G){var Z=!0;0==l&&(l=(l=t.val())?parseFloat(l):0);var e=(v=h.val())?v=parseFloat(v):0;I.trigger("change.s3",!0)}h.change(function(){(e=h.val())?(e=parseFloat(e),$("#inv_track_item_quantity-error").remove()):e=0;e>g&&(message="Total Quantity reduced to Quantity in Stock",
n=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),h.val(g).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),e=g);1==m?aa():1<m&&(A=l*k/b,e<A&&(message="Total Quantity increased to Quantity in Bins",n=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+
message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),h.val(A).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1})),p.change())});p.change(function(){if(1<m&&(a=p.val())){a=parseFloat(a);if(P=ka.val())B=J[P],w=B*k/b,a>w&&(message="Bin Quantity reduced to Quantity of Stock in Bin",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+
message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),p.val(w).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),a=w);A=l*k/b;E=e-A;a>E&&(message="Bin Quantity reduced to Quantity remaining to be Sent",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
p.val(E).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});t.change(function(){if(1<m&&(a=t.val())){a=parseFloat(a);if(P=la.val())B=J[P],w=B*k/b,a>w&&(message="Bin Quantity reduced to Quantity of Stock in Bin",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
t.val(w).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),a=w);A=l*k/b;E=e-A;a>E&&(message="Bin Quantity reduced to Quantity remaining to be Sent",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(E).parent().append(n).undelegate(".s3").delegate(".alert",
"click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});F.on("click.s3",".inline-edt",function(){1<m&&(a=t.val())&&(a=parseFloat(a),l-=a*b/k)});ia.click(function(){if(1<m){if(a=t.val())a=parseFloat(a),l+=a*b/k;p.change()}});F.on("rowAdded",function(f,z){if(1<m){if(a=z.quantity.value)a=parseFloat(a),l+=a*b/k;$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning").remove()}});F.on("rowRemoved",function(f,z){1<m&&(a=z.quantity.value)&&(a=parseFloat(a),l-=a*b/k)})}});
