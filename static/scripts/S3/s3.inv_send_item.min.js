$(document).ready(function(){var I=$("#inv_track_item_send_inv_item_id");if(I.length){var ja=S3.supply.inv_items,ba,D,y,a,l=S3.supply.binnedQuantity||0,z,U=$("#inv_track_item_sub_defaultsend_bin__row"),A,w,J,P,m,ka=$("#rdy-defaultbin-0"),n,ca=$("#quantity__error"),b,E=$("#sub-defaultsend_bin"),V,k,Q=$("#inv_track_item_item_pack_id"),R,la=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none"),p=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none"),B=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none-hierarchy"),
da=/(\d)(?=(\d{3})+(?!\d))/g,ma=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0"),t=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0"),C,ea,d,c,K,L,S,fa,h=$("#inv_track_item_quantity"),W=$("#inv_track_item_req_item_id__row"),u,M,na=S3.supply.site_id,F=I.val(),v,ha=S3.supply.itemPackID,X=1,g,oa=$('div[id^="sub_defaultsend_bin_defaultsend_bin_i_layout_id"].s3-hierarchy-widget'),T,Y;W.length&&W.hide();var aa=function(){Z?(T=function(f){f.quantity.value=e;f.quantity.text=e.toString().replace(da,
"$1,")},E.inlinecomponent("updateRows",T),$("#edt-defaultsend_bin-0").hide(),$("#rmv-defaultsend_bin-0").hide()):(U.show(),A=J[0].q,A*k>e*c?p.val(e):p.val(A*k/c))};I.on("change.s3",function(f,x){var G=I.val();Q.html("");x||(Z=!1,h.val(""),e=0,E.inlinecomponent("removeRows"),l=0);$("#TotalQuantity").remove();f=ja[G];V=f.q;L=f.p;S=L.length;u=f.r;for(b=0;b<S;b++)if(d=L[b],1==d.q){fa=d.n;break}for(b=0;b<S;b++){d=L[b];if(void 0!=d.d){var ia=!0;k=d.q}else ia=!1;ha&&F==G&&ha==d.i?(R=d.i,C=X=c=d.q,K=d.n,
M=" selected"):ia?(R=d.i,C=c=d.q,K=d.n,M=" selected"):M="";ea=1!==d.q?'<option value="'+d.i+'"'+M+">"+d.n+" ("+d.q+" x "+fa+")</option>":'<option value="'+d.i+'"'+M+">"+d.n+"</option>";Q.append(ea)}x&&(l=l*k/c);J=f.b;m=J.length;if(0==m)U.hide();else if(1==m)if(Z)$("#add-row-defaultsend_bin").hide(),$("#read-row-defaultsend_bin-0 > .subform-action").hide();else{aa();var N=function(){B.hierarchicalopts("set",[J[0].l]);p.attr("disabled","disabled");$("#add-row-defaultsend_bin > .subform-action").hide();
B.next(".s3_inline_add_resource_link").hide();$(".s3-hierarchy-button").attr("disabled","disabled")};if(B.is(":data('s3-hierarchicalopts')"))N();else B.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()})}else{P={};for(b=0;b<m;b++)y=J[b],P[y.l]=y.q;U.show();N=function(){p.removeAttr("disabled");$("#add-row-defaultsend_bin > .subform-action").show();B.next(".s3_inline_add_resource_link").show();$(".s3-hierarchy-button").removeAttr("disabled");ba=S3.Ap.concat("/org/site/"+na+"/layout/hierarchy.tree?inv_item_id="+
G);oa.hierarchicalopts("reload",ba)};if(B.is(":data('s3-hierarchicalopts')"))N();else B.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()})}if(ca.length)for(f=ca.html().split(" "),b=0;b<f.length&&!(g=parseFloat(f[b]));b++);else g=V*k/c,v&&F==G&&(g+=v*X/c);f='<span id="TotalQuantity"> / '+g.toFixed(2)+" "+K+" ("+i18n.in_inv+")</span>";h.after(f);if(u){var q=u[0];Y=function(){if(1==u.length){if(!v||F!=G){var r=q.q/c;e=r<=g?r:g;h.val(e);1==m&&aa()}$("#inv_track_item_req_item_id").val(q.i)}else{W.show();
var O=$("#inv_track_item_req_item_id"),H=O.val();H&&=parseInt(H);O.html("");for(b=0;b<u.length;b++)q=u[b],O.append(new Option(q.r,q.i)),H?q.i!=H||v&&F==G||(r=q.q/c,r<=g?h.val(r):h.val(g)):x&&(r=q.q/c,r<=g?h.val(r):h.val(g)),x=!1;O.on("change",function(){H=parseInt(O.val());for(b=0;b<u.length;b++)if(q=u[b],q.i==H){r=q.q/c;r<=g?h.val(r):h.val(g);break}})}};Y()}});Q.on("change.s3",function(){R=parseInt(Q.val());for(b=0;b<S;b++)if(d=L[b],d.i==R){c=d.q;K=d.n;g=V*k/c;v&&F==inv_item_id&&(g+=v*X/c);$("#TotalQuantity").html(g.toFixed(2)+
" "+K+" ("+i18n.in_inv+")");e=h.val();e=e*C/c;h.val(e);a=p.val();a=a*C/c;p.val(a);a=t.val();a=a*C/c;t.val(a);T=function(f){a=f.quantity.value;a=a*C/c;f.quantity.value=a;f.quantity.text=a.toString().replace(da,"$1,")};E.inlinecomponent("updateRows",T);C=c;u&&Y();break}});if(F){var Z=!0;0==l&&(l=(l=t.val())?parseFloat(l):0);var e=(v=h.val())?v=parseFloat(v):0;I.trigger("change.s3",!0)}h.change(function(){(e=h.val())?(e=parseFloat(e),$("#inv_track_item_quantity-error").remove()):e=0;e>g&&(message="Total Quantity reduced to Quantity in Stock",
n=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),h.val(g).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),e=g);1==m?aa():1<m&&(z=l*k/c,e<z&&(message="Total Quantity increased to Quantity in Bins",n=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+
message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),h.val(z).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1})),p.change())});p.change(function(){if(1<m&&(a=p.val())){a=parseFloat(a);if(y=la.val())A=P[y],w=A*k/c,a>w&&(message="Bin Quantity reduced to Quantity of Stock in Bin",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+
message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),p.val(w).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),a=w);z=l*k/c;D=e-z;a>D&&(message="Bin Quantity reduced to Quantity remaining to be Sent",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
p.val(D).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});t.change(function(){if(1<m&&(a=t.val())){a=parseFloat(a);if(y=ma.val())A=P[y],w=A*k/c,a>w&&(message="Bin Quantity reduced to Quantity of Stock in Bin",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
t.val(w).parent().append(n).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}),a=w);z=l*k/c;D=e-z;a>D&&(message="Bin Quantity reduced to Quantity remaining to be Sent",n=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(D).parent().append(n).undelegate(".s3").delegate(".alert",
"click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});E.on("click.s3",".inline-edt",function(){1<m&&(a=t.val())&&(a=parseFloat(a),l-=a*c/k)});ka.click(function(){if(1<m){if(a=t.val())a=parseFloat(a),l+=a*c/k;p.change()}});E.on("rowAdded",function(f,x){if(1<m){if(a=x.quantity.value)a=parseFloat(a),l+=a*c/k;$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning").remove()}});E.on("rowRemoved",function(f,x){1<m&&(a=x.quantity.value)&&(a=parseFloat(a),l-=a*c/k)})}});
