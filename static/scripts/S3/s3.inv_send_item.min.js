$(document).ready(function(){var I=$("#inv_track_item_send_inv_item_id");if(I.length){var D,P,a,l=S3.supply.binnedQuantity||0,z,U=$("#inv_track_item_sub_defaultsend_bin__row"),A,E,B,J,m,ia=$("#rdy-defaultbin-0"),r,ba=$("#quantity__error"),d,F=$("#sub-defaultsend_bin"),w,ja=S3.supply.inv_items,V,h,Q=$("#inv_track_item_item_pack_id"),R,ka=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none"),n=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none"),x=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none-hierarchy"),
ca=/(\d)(?=(\d{3})+(?!\d))/g,la=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0"),t=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0"),C,ma=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0-hierarchy"),da,e,b,K,L,S,ea,k=$("#inv_track_item_quantity"),W=$("#inv_track_item_req_item_id__row"),u,M,G=I.val(),v,fa=S3.supply.itemPackID,X=1,g;$('div[id^="sub_defaultsend_bin_defaultsend_bin_i_layout_id"].s3-hierarchy-widget');var T,Y;W.length&&W.hide();var aa=function(){Z?(T=function(f){f.quantity.value=
c;f.quantity.text=c.toString().replace(ca,"$1,")},F.inlinecomponent("updateRows",T),$("#edt-defaultsend_bin-0").hide(),$("#rmv-defaultsend_bin-0").hide()):(U.show(),A=J[B[0]],A*h>c*b?n.val(c):n.val(A*h/b))};I.on("change.s3",function(f,y){w=I.val();Q.html("");y||(Z=!1,k.val(""),c=0,F.inlinecomponent("removeRows"),l=0);$("#TotalQuantity").remove();if(w){f=ja[w];V=f.q;L=f.p;S=L.length;u=f.r;for(d=0;d<S;d++)if(e=L[d],1==e.q){ea=e.n;break}for(d=0;d<S;d++){e=L[d];if(void 0!=e.d){var ha=!0;h=e.q}else ha=
!1;fa&&G==w&&fa==e.i?(R=e.i,C=X=b=e.q,K=e.n,M=" selected"):ha?(R=e.i,C=b=e.q,K=e.n,M=" selected"):M="";da=1!==e.q?'<option value="'+e.i+'"'+M+">"+e.n+" ("+e.q+" x "+ea+")</option>":'<option value="'+e.i+'"'+M+">"+e.n+"</option>";Q.append(da)}y&&(l=l*h/b);J=f.b;B=[];for(layoutID in J)B.push(layoutID);m=B.length;if(0==m)U.hide();else if(1==m)if(Z)$("#add-row-defaultsend_bin").hide(),$("#read-row-defaultsend_bin-0 > .subform-action").hide();else{aa();var N=function(){x.hierarchicalopts("set",[B[0]]);
n.attr("disabled",!0);$("#add-row-defaultsend_bin > .subform-action").hide();x.next(".s3_inline_add_resource_link").hide();$(".s3-hierarchy-button").attr("disabled",!0)};if(x.is(":data('s3-hierarchicalopts')"))N();else x.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()})}else if(U.show(),N=function(){n.removeAttr("disabled");$("#add-row-defaultsend_bin > .subform-action").show();x.next(".s3_inline_add_resource_link").show();$(".s3-hierarchy-button").removeAttr("disabled");x.hierarchicalopts("show",
B,!0);ma.hierarchicalopts("show",B,!0)},x.is(":data('s3-hierarchicalopts')"))N();else x.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()});if(ba.length)for(f=ba.html().split(" "),d=0;d<f.length&&!(g=parseFloat(f[d]));d++);else g=V*h/b,v&&G==w&&(g+=v*X/b);f='<span id="TotalQuantity"> / '+g.toFixed(2)+" "+K+" ("+i18n.in_inv+")</span>";k.after(f);if(u){var p=u[0];Y=function(){if(1==u.length){if(!v||G!=w){var q=p.q/b;c=q<=g?q:g;k.val(c);1==m&&aa()}$("#inv_track_item_req_item_id").val(p.i)}else{W.show();
var O=$("#inv_track_item_req_item_id"),H=O.val();H&&=parseInt(H);O.html("");for(d=0;d<u.length;d++)p=u[d],O.append(new Option(p.r,p.i)),H?p.i!=H||v&&G==w||(q=p.q/b,q<=g?k.val(q):k.val(g)):y&&(q=p.q/b,q<=g?k.val(q):k.val(g)),y=!1;O.on("change",function(){H=parseInt(O.val());for(d=0;d<u.length;d++)if(p=u[d],p.i==H){q=p.q/b;q<=g?k.val(q):k.val(g);break}})}};Y()}}});Q.on("change.s3",function(){R=parseInt(Q.val());for(d=0;d<S;d++)if(e=L[d],e.i==R){b=e.q;K=e.n;g=V*h/b;v&&G==w&&(g+=v*X/b);$("#TotalQuantity").html(g.toFixed(2)+
" "+K+" ("+i18n.in_inv+")");c=k.val();c=c*C/b;k.val(c);a=n.val();a=a*C/b;n.val(a);a=t.val();a=a*C/b;t.val(a);T=function(f){a=f.quantity.value;a=a*C/b;f.quantity.value=a;f.quantity.text=a.toString().replace(ca,"$1,")};F.inlinecomponent("updateRows",T);C=b;u&&Y();break}});if(G){var Z=!0;0==l&&(l=(l=t.val())?parseFloat(l):0);var c=(v=k.val())?v=parseFloat(v):0;I.trigger("change.s3",!0)}k.change(function(){(c=k.val())?(c=parseFloat(c),$("#inv_track_item_quantity-warning").remove()):c=0;message=null;c>
g?(c=g,message="Total Quantity reduced to Quantity in Stock"):0>c&&(c=0,message="Total Quantity cannot be negative");1==m?aa():1<m&&(z=l*h/b,c<z&&(c=z,message="Total Quantity increased to Quantity in Bins"),n.change());message&&(r=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),k.val(c).parent().append(r).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();
return!1}))});n.change(function(){if(1<m&&(a=n.val())){a=parseFloat(a);if(P=ka.val())A=J[P],E=A*h/b,a>E&&(a=E,message="Bin Quantity reduced to Quantity of Stock in Bin",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),n.val(a).parent().append(r).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();
return!1}));z=l*h/b;D=c-z;a>D&&(message="Bin Quantity reduced to Quantity remaining to be Sent",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),n.val(D).parent().append(r).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});t.change(function(){if(1<m&&(a=t.val())){a=parseFloat(a);
if(P=la.val())A=J[P],E=A*h/b,a>E&&(a=E,message="Bin Quantity reduced to Quantity of Stock in Bin",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(a).parent().append(r).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}));z=l*h/b;D=c-z;a>D&&(message="Bin Quantity reduced to Quantity remaining to be Sent",
r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(D).parent().append(r).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))}});F.on("click.s3",".inline-edt",function(){1<m&&(a=t.val())&&(a=parseFloat(a),l-=a*b/h)});ia.click(function(){if(1<m){if(a=t.val())a=parseFloat(a),
l+=a*b/h;n.change()}});F.on("rowAdded",function(f,y){if(1<m){if(a=y.quantity.value)a=parseFloat(a),l+=a*b/h;$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning").remove()}});F.on("rowRemoved",function(f,y){1<m&&(a=y.quantity.value)&&(a=parseFloat(a),l-=a*b/h)})}});
